<!DOCTYPE html>
<html>
<head>
    <title>Cycling Day End Report</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>

/* ============================= */
/* üî∑ GLOBAL DESIGN SYSTEM */
/* ============================= */

* {
    box-sizing: border-box;
}

body {
    margin: 0;
    font-family: 'Inter', 'Segoe UI', sans-serif;
    background: #f4f6f9;
    color: #1a1a1a;
}

/* ============================= */
/* üî∑ HEADER */
/* ============================= */

.header {
    background: linear-gradient(135deg,#003366,#007bff);
    color: white;
    padding: 25px;
    text-align: center;
    font-size: 22px;
    font-weight: 600;
    letter-spacing: 1px;
}

/* ============================= */
/* üî∑ CONTAINER */
/* ============================= */

.container {
    max-width: 1200px;
    margin: auto;
    padding: 30px 20px;
}

/* ============================= */
/* üî∑ KPI CARDS */
/* ============================= */

.kpi-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.kpi-card {
    background: white;
    padding: 20px;
    border-radius: 14px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.05);
}

.kpi-card h4 {
    margin: 0 0 10px;
    font-size: 14px;
    color: #777;
}

.kpi-card p {
    margin: 0;
    font-size: 22px;
    font-weight: 600;
}

/* ============================= */
/* üî∑ CARD SECTION */
/* ============================= */

.card {
    background: white;
    padding: 28px;
    border-radius: 16px;
    box-shadow: 0 6px 25px rgba(0,0,0,0.05);
    margin-bottom: 30px;
}

.card h2 {
    margin-top: 0;
    margin-bottom: 25px;
    font-size: 18px;
    border-left: 4px solid #007bff;
    padding-left: 10px;
}

/* ============================= */
/* üî∑ FORM GRID */
/* ============================= */

.grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 22px;
}

label {
    font-size: 13px;
    font-weight: 600;
    margin-bottom: 6px;
    display: block;
}

input {
    width: 100%;
    padding: 12px;
    border-radius: 10px;
    border: 1px solid #ddd;
    font-size: 14px;
    transition: 0.2s ease;
}

input:focus {
    border-color: #007bff;
    outline: none;
    box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
}

/* ============================= */
/* üî∑ BUTTONS */
/* ============================= */

.actions {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
    justify-content: center;
}

button {
    padding: 14px 24px;
    border-radius: 10px;
    border: none;
    font-weight: 600;
    cursor: pointer;
    font-size: 14px;
    transition: 0.2s ease;
}

.btn-primary {
    background: #007bff;
    color: white;
}

.btn-success {
    background: #28a745;
    color: white;
}

.btn-dark {
    background: #333;
    color: white;
}

.btn-danger {
    background: #dc3545;
    color: white;
}

button:hover {
    transform: translateY(-2px);
    opacity: 0.9;
}

/* ============================= */
/* üî∑ REPORT OUTPUT */
/* ============================= */

.output {
    white-space: pre-wrap;
    background: #f9fbff;
    padding: 20px;
    border-radius: 12px;
    font-size: 14px;
    border: 1px solid #e3e8f0;
}

/* ============================= */
/* üî∑ MESSAGE */
/* ============================= */

.message {
    padding: 12px;
    border-radius: 10px;
    margin-bottom: 20px;
    display: none;
    font-weight: 500;
}

.success { background: #e6ffed; color: #1a7f37; }
.error { background: #ffe6e6; color: #c0392b; }

/* ============================= */
/* üî∑ MODAL */
/* ============================= */

.modal {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.4);
    justify-content: center;
    align-items: center;
}

.modal-content {
    background: white;
    padding: 30px;
    border-radius: 16px;
    width: 350px;
}

/* ============================= */
/* üì± MOBILE */
/* ============================= */

@media (max-width: 600px) {

    .actions {
        flex-direction: column;
    }

    button {
        width: 100%;
    }
}

/* ============================= */
/* üîÑ LOADING OVERLAY */
/* ============================= */

.loader-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.4);
    backdrop-filter: blur(4px);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 9999;
}

.loader-box {
    background: white;
    padding: 30px 40px;
    border-radius: 16px;
    text-align: center;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
}

.spinner {
    width: 45px;
    height: 45px;
    border: 4px solid #e3e3e3;
    border-top: 4px solid #007bff;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
    margin: 0 auto 15px;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

/* ============================= */
/* üîê MODAL DESIGN UPGRADE */
/* ============================= */

.modal {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.5);
    backdrop-filter: blur(6px);
    justify-content: center;
    align-items: center;
    z-index: 10000;
}

.modal-content {
    background: white;
    padding: 30px;
    border-radius: 18px;
    width: 380px;
    box-shadow: 0 20px 50px rgba(0,0,0,0.25);
    animation: modalFade 0.25s ease;
    position: relative;
}

@keyframes modalFade {
    from { transform: scale(0.95); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.close-btn {
    cursor: pointer;
    font-size: 18px;
    opacity: 0.6;
}

.close-btn:hover {
    opacity: 1;
}

.admin-section label {
    display: block;
    font-size: 13px;
    font-weight: 600;
    margin-top: 15px;
    margin-bottom: 6px;
}

.modal-actions {
    margin-top: 20px;
    display: flex;
    gap: 12px;
    justify-content: space-between;
}

/* ============================= */
/* üîÑ ADMIN LOADER */
/* ============================= */

.admin-loader {
    display: none;
    text-align: center;
    padding: 20px 0;
}

.small-spinner {
    width: 35px;
    height: 35px;
    border: 4px solid #e3e3e3;
    border-top: 4px solid #007bff;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
    margin: 0 auto 12px;
}

textarea {
    width: 100%;
    padding: 12px;
    border-radius: 10px;
    border: 1px solid #ddd;
    font-size: 14px;
    resize: vertical;
    min-height: 120px;
    transition: 0.2s ease;
    font-family: inherit;
}

textarea:focus {
    border-color: #007bff;
    outline: none;
    box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
}




    </style>
</head>

<body>

<div class="header">
    üö¥ Cycling Department ‚Äî Day End Dashboard
</div>

<div class="container">

<div id="messageBox" class="message"></div>

<!-- KPI SECTION -->


<!-- DAILY INPUTS -->
<div class="card">
    <h2>Daily Inputs</h2>

    <div class="grid">
        <div>
            <label>Sport Name</label>
            <input id="sport" value="Cycling">
        </div>

        <div>
            <label>Date</label>
            <input type="date" id="date">
        </div>

        <div>
            <label>Day Piloting (‚Çπ)</label>
            <input type="number" id="target">
        </div>

        <div>
            <label>Achieved (‚Çπ)</label>
            <input type="number" id="sales">
        </div>

        <div>
            <label>Total Quantity</label>
            <input type="number" id="quantity">
        </div>

        <div>
            <label>Margin (%)</label>
            <input type="number" id="margin">
        </div>

        <div>
            <label>Working Hours</label>
            <input type="number" id="hours">
        </div>

        <div>
            <label>Digital Sales (‚Çπ)</label>
            <input type="number" id="digital">
        </div>
    </div>
</div>

<!-- üìù SYNTHESIS SECTION -->
<div class="card">
    <h2>Daily Synthesis</h2>

    <label>Key Highlights / Issues / Action Plan</label>
    <textarea id="synthesis" rows="5" placeholder="Write performance summary, challenges, action plan for tomorrow..."></textarea>
</div>


<!-- MONTHLY SECTION -->


<!-- ACTION BUTTONS -->
<div class="card">
    <div class="actions">
        <button class="btn-primary" onclick="submitReport()">Submit & Save</button>
        <button class="btn-dark" onclick="openAdminModal()">üîê Admin</button>
    </div>
</div>

<!-- REPORT SECTION -->
<div class="card">
    <h2>WhatsApp Ready Report</h2>
    <div class="output" id="report"></div>
    <br>
    <button class="btn-success" onclick="copyReport()">Copy for WhatsApp</button>
</div>

</div>

<!-- Admin Modal remains same as yours -->



<!-- üîê ADMIN MODAL -->
<div class="modal" id="adminModal">
    <div class="modal-content">

        <div class="modal-header">
            <h3>üîê Admin Panel</h3>
            <span class="close-btn" onclick="closeAdmin()">‚úï</span>
        </div>

        <!-- üîÑ ADMIN LOADER -->
        <div class="admin-loader" id="adminLoader">
            <div class="small-spinner"></div>
            <p>Updating Monthly Data...</p>
        </div>

        <!-- STEP 1 -->
        <div id="adminStep1" class="admin-section">
            <label>Enter Secret Code</label>
            <input type="password" id="adminSecret">

            <div class="modal-actions">
                <button class="btn-primary" onclick="verifyAdmin()">Verify</button>
                <button class="btn-danger" onclick="closeAdmin()">Cancel</button>
            </div>
        </div>

        <!-- STEP 2 -->
        <div id="adminStep2" class="admin-section" style="display:none;">

            <label>Select Date</label>
            <input type="date" id="adminDate">

            <label>New Monthly Piloting</label>
            <input type="number" id="adminPiloting">

            <label>New Monthly Achieved</label>
            <input type="number" id="adminAchieved">

            <div class="modal-actions">
                <button class="btn-primary" onclick="submitAdmin()">Update</button>
                <button class="btn-danger" onclick="closeAdmin()">Cancel</button>
            </div>
        </div>

    </div>
</div>


<script>

const scriptURL = "https://script.google.com/macros/s/AKfycbzk1GN48OujupHuNBeRrhuC74l-qdtYz2fdN9rH_Gjn5OsZ3PxV_3JwB7CBIi8yOJ9PNw/exec";

/* ============================= */
/* üîî MESSAGE SYSTEM */
/* ============================= */

function showMessage(text, type) {
    const box = document.getElementById("messageBox");
    box.innerText = text;
    box.className = "message " + type;
    box.style.display = "block";

    setTimeout(() => {
        box.style.display = "none";
    }, 3000);
}

/* ============================= */
/* üì§ SUBMIT DAILY REPORT */
/* ============================= */

async function submitReport() {

    showLoader();

    try {

        const data = {
            sport: document.getElementById("sport").value,
            date: document.getElementById("date").value,
            target: document.getElementById("target").value,
            sales: document.getElementById("sales").value,
            quantity: document.getElementById("quantity").value,
            margin: document.getElementById("margin").value,
            hours: document.getElementById("hours").value,
            digital: document.getElementById("digital").value
        };

        if (!data.date) {
            showMessage("Date is required ‚ùó", "error");
            hideLoader();
            return;
        }

        const response = await fetch(scriptURL, {
            method: "POST",
            headers: { "Content-Type": "text/plain" },
            body: JSON.stringify(data)
        });

        const result = await response.json();

        if (result.error) {
            showMessage(result.error, "error");
            hideLoader();
            return;
        }

        showMessage("Saved Successfully ‚úÖ", "success");

        generateReport(
            result.updatedMonthlyAchieved,
            result.realization,
            result.monthlyTarget
        );

    } catch (err) {
        console.error(err);
        showMessage("Network Error ‚ùå", "error");
    }

    hideLoader();
}

/* ============================= */
/* üìä GENERATE REPORT */
/* ============================= */

function generateReport(monthlyAchieved = 0, realization = 0, monthlyTarget = 0) {

    const dayTarget = Number(document.getElementById("target").value) || 0;
    const dayAchieved = Number(document.getElementById("sales").value) || 0;
    const qty = Number(document.getElementById("quantity").value) || 0;
    const hrs = Number(document.getElementById("hours").value) || 0;
    const marginValue = Number(document.getElementById("margin").value) || 0;
    const digitalValue = Number(document.getElementById("digital").value) || 0;

    const efficiency = hrs > 0 ? (qty / hrs).toFixed(2) : 0;

    const achievementPercent = dayTarget > 0
        ? ((dayAchieved / dayTarget) * 100).toFixed(1)
        : 0;

    const digitalPercent = dayAchieved > 0
        ? ((digitalValue / dayAchieved) * 100).toFixed(1)
        : 0;

    const gap = monthlyTarget - monthlyAchieved;

    const manualSummary = document.getElementById("synthesis").value || "No summary provided.";


const report = `
CYCLING DEPARTMENT
DAY END PERFORMANCE REPORT

Date: ${document.getElementById("date").value}

------------------------------------------------------------
DAILY PERFORMANCE SUMMARY
------------------------------------------------------------
Dail Piloting: ‚Çπ${dayTarget.toLocaleString("en-IN")}
Day Achieved: ‚Çπ${dayAchieved.toLocaleString("en-IN")}
Achievement Percentage: ${achievementPercent}%

Total Quantity Sold: ${qty}
Total Working Hours: ${hrs}
Efficiency : ${efficiency}

Gross Margin: ${marginValue}%
Digital Sales Contribution: ‚Çπ${digitalValue.toLocaleString("en-IN")}
Digital Share of Sales: ${digitalPercent}%

------------------------------------------------------------
MONTHLY PERFORMANCE STATUS
------------------------------------------------------------
Month Piloting: ‚Çπ${Number(monthlyTarget || 0).toLocaleString("en-IN")}
Month Achieved: ‚Çπ${Number(monthlyAchieved || 0).toLocaleString("en-IN")}
Realization Percentage: ${realization || 0}%
Performance Gap: ‚Çπ${Number(gap || 0).toLocaleString("en-IN")}

------------------------------------------------------------
MANAGEMENT SYNTHESIS
------------------------------------------------------------
${manualSummary}

------------------------------------------------------------
Prepared for Internal Review
`;


    document.getElementById("report").innerText = report;
}

/* ============================= */
/* üìã COPY REPORT */
/* ============================= */

function copyReport() {
    const text = document.getElementById("report").innerText;
    navigator.clipboard.writeText(text);
    showMessage("Copied for WhatsApp!", "success");
}

/* ============================= */
/* üîê ADMIN FLOW */
/* ============================= */

function openAdminModal() {
    document.getElementById("adminModal").style.display = "flex";

    // Auto fill today's date
    const today = new Date().toISOString().split("T")[0];
    document.getElementById("adminDate").value = today;
}

function closeAdmin() {
    document.getElementById("adminModal").style.display = "none";
    document.getElementById("adminStep1").style.display = "block";
    document.getElementById("adminStep2").style.display = "none";
}

function verifyAdmin() {
    if (document.getElementById("adminSecret").value === "DECATHLON2026") {
        document.getElementById("adminStep1").style.display = "none";
        document.getElementById("adminStep2").style.display = "block";
    } else {
        showMessage("Invalid Secret ‚ùå", "error");
    }
}

async function submitAdmin() {

    showAdminLoader();

    try {

        const data = {
            adminMode: true,
            secret: document.getElementById("adminSecret").value,
            monthlyPiloting: document.getElementById("adminPiloting").value,
            monthlyAchievedEdit: document.getElementById("adminAchieved").value,
            date: document.getElementById("adminDate").value
        };

        if (!data.date) {
            showMessage("Date is required ‚ùó", "error");
            hideAdminLoader();
            return;
        }

        const response = await fetch(scriptURL, {
            method: "POST",
            headers: { "Content-Type": "text/plain" },
            body: JSON.stringify(data)
        });

        const result = await response.json();

        if (result.error) {
            showMessage(result.error, "error");
            hideAdminLoader();
            return;
        }

        showMessage("Monthly Updated üîê", "success");

        setTimeout(() => {
            hideAdminLoader();
            closeAdmin();
        }, 800);

    } catch (err) {
        console.error(err);
        showMessage("Network Error ‚ùå", "error");
        hideAdminLoader();
    }
}

/* ============================= */
/* üîÑ LOADING SYSTEM */
/* ============================= */

function showLoader() {
    document.getElementById("loader").style.display = "flex";
}

function hideLoader() {
    document.getElementById("loader").style.display = "none";
}

function showAdminLoader() {
    document.getElementById("adminLoader").style.display = "block";
    document.getElementById("adminStep1").style.display = "none";
    document.getElementById("adminStep2").style.display = "none";
}

function hideAdminLoader() {
    document.getElementById("adminLoader").style.display = "none";
}

</script>


<!-- üîÑ LOADING OVERLAY -->
<div class="loader-overlay" id="loader">
    <div class="loader-box">
        <div class="spinner"></div>
        <p>Saving Report...</p>
    </div>
</div>


</body>
</html>
